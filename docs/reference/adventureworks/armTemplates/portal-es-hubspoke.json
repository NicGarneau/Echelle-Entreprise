{
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
			"basics": {
				"resourceGroup": {
					"allowExisting": true
				}
			}
		},
        "basics": [
            {}
        ],
        "steps": [
		
		{
				"name": "configureVirtualMachines",
				"label": "Configure virtual machines",
				"subLabel": {
					"preValidation": "Usage profile and VM count",
					"postValidation": "Done"
				},
				"bladeTitle": "Configure number of VMs based on profile usage",
				"bladeSubtitle": "Select a usage profile and number of users to determine the recommended number of VMs",
				"elements": [
					{
						"name": "createAvailabilitySet",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Create an Availability Set",
						"toolTip": "Using an <a target='_blank' href='https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-availability-sets#availability-set-overview'>Availability set</a> limits you to a maximum of <a target='_blank' href='https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/azure-subscription-service-limits#virtual-machines-limits---azure-resource-manager'>200 virtual machines</a>.",
						"defaultValue": "Yes",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes",
									"value": true
								},
								{
									"label": "No",
									"value": false
								}
							]
						},
						"visible": "[not(basics('isPersonalDesktop').value)]"
					},
					{
						"name": "usageProfile",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Usage Profile",
						"defaultValue": "Medium",
						"toolTip": "Select a usage profile to determine the number of users per vCPU--Light (6), Medium (4), Heavy (2), or Power (1)--to use to calculate the number of virtual machines to create based on the selected VM size. If you would like to create a specific number of VMs, select 'Custom'.",
						"constraints": {
							"allowedValues": [
								{
									"label": "Light",
									"value": {
										"boolean": true,
										"value": 6,
										"usageProfileMultiplier": 1,
										"vmCountMultiplier": 0
									}
								},
								{
									"label": "Medium",
									"value": {
										"boolean": true,
										"value": 4,
										"usageProfileMultiplier": 1,
										"vmCountMultiplier": 0
									}
								},
								{
									"label": "Heavy",
									"value": {
										"boolean": true,
										"value": 2,
										"usageProfileMultiplier": 1,
										"vmCountMultiplier": 0
									}
								},
								{
									"label": "Power",
									"value": {
										"boolean": true,
										"value": 1,
										"usageProfileMultiplier": 1,
										"vmCountMultiplier": 0
									}
								},
								{
									"label": "Custom",
									"value": {
										"boolean": false,
										"value": 1,
										"usageProfileMultiplier": 0,
										"vmCountMultiplier": 1
									}
								}
							]
						},
						"visible": "[not(basics('isPersonalDesktop').value)]"
					},
					{
						"name": "totalUsers",
						"type": "Microsoft.Common.TextBox",
						"label": "Total users",
						"toolTip": "Enter number of users. This will be used to calculate number of virtual machines to deploy.",
						"defaultValue": "100",
						"constraints": {
							"required": true,
							"regex": "^[1-9][0-9]*$",
							"validationMessage": "Only positive values are allowed."
						},
						"visible": "[ or(basics('isPersonalDesktop').value, coalesce(steps('configureVirtualMachines').usageProfile.boolean, bool('true') )) ]"
					},
					{
						"name": "virtualMachineCount",
						"type": "Microsoft.Common.TextBox",
						"label": "Number of virtual machines",
						"toolTip": "Number of virtual machines to deploy.",
						"defaultValue": "100",
						"constraints": {
							"required": true,
							"regex": "^[1-9][0-9]*$",
							"validationMessage": "Only positive values are allowed."
						},
						"visible": "[and( not(basics('isPersonalDesktop').value) , not(coalesce(steps('configureVirtualMachines').usageProfile.boolean, bool('true'))) )]"
					},
					{
						"name": "virtualMachineSize",
						"type": "Microsoft.Compute.SizeSelector",
						"label": "Virtual machine size",
						"toolTip": "Size of the virtual machines to deploy. Not all VM sizes are supported by this Azure Marketplace offer however all VM sizes are supported when using other deployment options, see <a target='_blank' href='https://aka.ms/wvdmpsupportedsku'>https://aka.ms/wvdmpsupportedsku</a> for more information.",
						"osPlatform": "Windows",
						"constraints": {
							"allowedSizes": [
								"Standard_A1_v2",
								"Standard_A2_v2",
								"Standard_A2m_v2",
								"Standard_A4_v2",
								"Standard_A4m_v2",
								"Standard_A8_v2",
								"Standard_A8m_v2",
								"Standard_B1ms",
								"Standard_B1s",
								"Standard_B2ms",
								"Standard_B2s",
								"Standard_B4ms",
								"Standard_B8ms",
								"Standard_D2_v3",
								"Standard_D2s_v3",
								"Standard_D4_v3",
								"Standard_D4s_v3",
								"Standard_D8_v3",
								"Standard_D8s_v3",
								"Standard_D16_v3",
								"Standard_D16s_v3",
								"Standard_D32_v3",
								"Standard_D32s_v3",
								"Standard_D64_v3",
								"Standard_D64s_v3",
								"Standard_E2_v3",
								"Standard_E2s_v3",
								"Standard_E4_v3",
								"Standard_E4s_v3",
								"Standard_E8_v3",
								"Standard_E8s_v3",
								"Standard_E16_v3",
								"Standard_E16s_v3",
								"Standard_E20_v3",
								"Standard_E20s_v3",
								"Standard_E32_v3",
								"Standard_E32s_v3",
								"Standard_E64_v3",
								"Standard_E64s_v3",
								"Standard_F1",
								"Standard_F1s",
								"Standard_F2",
								"Standard_F2s",
								"Standard_F2s_v2",
								"Standard_F4",
								"Standard_F4s",
								"Standard_F4s_v2",
								"Standard_F8",
								"Standard_F8s",
								"Standard_F8s_v2",
								"Standard_F16",
								"Standard_F16s",
								"Standard_F16s_v2",
								"Standard_F32s_v2",
								"Standard_F64s_v2",
								"Standard_F72s_v2",
								"Standard_H8",
								"Standard_H8m",
								"Standard_H16",
								"Standard_H16m",
								"Standard_H16r",
								"Standard_H16mr",
								"Standard_L4s",
								"Standard_L8s",
								"Standard_L8s_v2",
								"Standard_L16s",
								"Standard_L16s_v2",
								"Standard_L32s",
								"Standard_L32s_v2",
								"Standard_L64s_v2",
								"Standard_L80s_v2",
								"Standard_M8ms",
								"Standard_M16ms",
								"Standard_M32ms",
								"Standard_M64",
								"Standard_M64m",
								"Standard_M64ms",
								"Standard_M64s",
								"Standard_NC6",
								"Standard_NC6s_v2",
								"Standard_NC6s_v3",
								"Standard_NC12",
								"Standard_NC12s_v2",
								"Standard_NC12s_v3",
								"Standard_NC24",
								"Standard_NC24r",
								"Standard_NC24rs_v2",
								"Standard_NC24rs_v3",
								"Standard_NC24s_v2",
								"Standard_NC24s_v3",
								"Standard_ND6s",
								"Standard_ND12s",
								"Standard_ND24rs",
								"Standard_ND24s",
								"Standard_NV6",
								"Standard_NV6s_v2",
								"Standard_NV12",
								"Standard_NV12s_v2",
								"Standard_NV24",
								"Standard_NV24s_v2",
								"Standard_D2hs_v3",
								"Standard_D4hs_v3",
								"Standard_D8hs_v3",
								"Standard_B2hms",
								"Standard_B4hms",
								"Standard_NV4ahs_v4",
								"Standard_NV8ahs_v4",
								"Standard_NV16ahs_v4",
								"Standard_NV32ah7s_v4",
								"Standard_NV12hs_v3",
								"Standard_NV6h",
								"Standard_NV12s_v3",
								"Standard_NV24s_v3",
								"Standard_NV48s_v3",
								"Standard_NV4as_v4",
								"Standard_NV8as_v4",
								"Standard_NV16as_v4",
								"Standard_NV32as_v4"
							]
						},
						"recommendedSizes": [
							"Standard_D4s_v3",
							"Standard_D4_v3",
							"Standard_B4ms"
						],
						"imageReference": {
							"publisher": "MicrosoftWindowsDesktop",
							"offer": "Windows-10",
							"sku": "rs5-evd"
						},
						"visible": true,
						"count": "[max( mul(coalesce(steps('configureVirtualMachines').usageProfile.vmCountMultiplier, '0'),int(coalesce(steps('configureVirtualMachines').virtualMachineCount, '1'))), max(mul(basics('isPersonalDesktop').personalMultiplier, int(coalesce(steps('configureVirtualMachines').totalUsers,'1'))), mul( coalesce(steps('configureVirtualMachines').usageProfile.usageProfileMultiplier,'0'), div (sub (add( mul(int(take(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(skip(replace(replace(steps('configureVirtualMachines').virtualMachineSize, 'Standard_', ''), 'Basic_', ''), 1), '_', '  '), 'C', ''), 'V', ''), 'S', ''), 'D', ''), 'B', ''), 's', ' '), 'm', ' '), 'r', ' '), 'i', ' '), 'h', ' '), 'a', ' '), 'l', ' '), 't', ' '), 3)), coalesce(steps('configureVirtualMachines').usageProfile.value,'1') ), int(coalesce(steps('configureVirtualMachines').totalUsers,'1') )),1),   mul(int(take(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(skip(replace(replace(steps('configureVirtualMachines').virtualMachineSize, 'Standard_', ''), 'Basic_', ''), 1), '_', '  '), 'C', ''), 'V', ''), 'S', ''), 'D', ''), 'B', ''), 's', ' '), 'm', ' '), 'r', ' '), 'i', ' '), 'h', ' '), 'a', ' '), 'l', ' '), 't', ' '), 3)), coalesce(steps('configureVirtualMachines').usageProfile.value,'1') ))  )))]"
					},
					{
						"name": "rdshNamePrefix",
						"type": "Microsoft.Common.TextBox",
						"label": "Virtual machine name prefix",
						"toolTip": "This prefix will be used in combination with the VM number to create the VM name. If using 'rdsh' as the prefix, VMs would be named 'rdsh-0', 'rdsh-1', etc. You should use a unique prefix to reduce name collisions in Active Directory and in Windows Virtual Desktop.",
						"constraints": {
							"required": true,
							"regex": "^[a-zA-Z0-9][a-zA-Z0-9-]{0,11}$",
							"validationMessage": "The prefix for virtual machines can only contain alphanumeric values and hypens, but may not start with a hyphen. The prefix may not be shorter than 2 characters or longer than 12 characters."
						},
						"visible": true
					}
				]
			},
			{
				"name": "virtualMachineSettings",
				"label": "Virtual machine settings",
				"subLabel": {
					"preValidation": "Select VM configuration settings",
					"postValidation": "Done"
				},
				"bladeTitle": "Configure the VMs for Azure",
				"bladeSubtitle": "VM configuration",
				"elements": [
					{
						"name": "vmImageType",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Image source",
						"defaultValue": "Gallery",
						"toolTip": "Select Blob storage to provide a generalized .vhd image in blob storage, 'Managed image' to provide an existing manage image from an Azure resource group, or 'Gallery' to select an image from the Azure Gallery.",
						"constraints": {
							"allowedValues": [
								{
									"label": "Blob storage",
									"value": "CustomVHD"
								},
								{
									"label": "Managed image",
									"value": "CustomImage"
								},
								{
									"label": "Gallery",
									"value": "Gallery"
								}
							]
						},
						"visible": true
					},
					{
						"name": "imageURI",
						"type": "Microsoft.Common.TextBox",
						"label": "imageURI",
						"toolTip": "Enter the URL for the generalized .vhd file from your storage account, such as https://mystorageaccount.blob.core.windows.net/vhds/mycustomimage.vhd",
						"constraints": {
							"required": true,
							"regex": "^(http(s)?:\/\/)[a-z0-9]{3,24}(\\.blob\\.core\\.windows\\.net\/.+)(\\.vhd)$",
							"validationMessage": "Please enter a valid URL for .vhd file from your storage account. It should be in the format of 'https://[storageaccountname].blob.core.windows.net/[container]/[imagename].vhd'"
						},
						"visible": "[equals(steps('virtualMachineSettings').vmImageType, 'CustomVHD')]"
					},
					{
						"name": "rdshCustomImageSourceName",
						"type": "Microsoft.Common.TextBox",
						"label": "Image name",
						"toolTip": "Enter the name of the Azure managed image to be used as the source OS for the virtual machines.",
						"constraints": {
							"required": true,
							"regex": "^[A-Za-z0-9]([\\w\\.-]*\\w)*$",
							"validationMessage": "The name must begin with a letter or number, end with a letter, number or underscore, and may contain only letters, numbers, underscores, periods, or hyphens."
						},
						"visible": "[equals(steps('virtualMachineSettings').vmImageType, 'CustomImage')]"
					},
					{
						"name": "rdshCustomImageSourceResourceGroup",
						"type": "Microsoft.Common.TextBox",
						"label": "Image resource group name",
						"toolTip": "Enter the name of the existing resouce group that contains the Azure managed image.",
						"constraints": {
							"required": true,
							"regex": "^[-\\w\\._\\(\\)]{0,89}[-\\w_\\(\\)]$",
							"validationMessage": "The only allowed characters are alphanumeric, underscore, parentheses, hyphen, and period (except at the end). 90 characters is the maximum length. If your resource group name contains Unicode characters, please move your image to a resource group whose name meets these requirements."
						},
						"visible": "[equals(steps('virtualMachineSettings').vmImageType, 'CustomImage')]"
					},
					{
						"name": "rdshCustomImageWarning",
						"type": "Microsoft.Common.InfoBox",
						"visible": "[equals(steps('virtualMachineSettings').vmImageType, 'CustomImage')]",
						"options": {
							"icon": "Warning",
							"text": "Ensure that the managed image is both in the specified Azure subscription and in the Azure location you selected."
						}
					},
					{
						"name": "galleryImageSelection",
						"type": "Microsoft.Common.DropDown",
						"label": "Image OS version",
						"defaultValue": "Windows 10 Enterprise multi-session, Version 2004 + Microsoft 365 Apps",
						"toolTip": "Select the OS Image for the virtual machine.",
						"constraints": {
							"allowedValues": [
								{
									"label": "Windows 10 Enterprise multi-session, Version 2004 + Microsoft 365 Apps",
									"value": "Windows-10-Enterprise-multi-session-with-Office-365-ProPlus-2004"
								},
								{
									"label": "Windows 10 Enterprise multi-session, Version 2004",
									"value": "Windows-10-Enterprise-multi-session-2004"
								},
								{
									"label": "Windows 10 Enterprise, Version 2004",
									"value": "Windows-10-Enterprise-2004"
								},
								{
									"label": "Windows 10 Enterprise multi-session, Version 1909 + Microsoft 365 Apps",
									"value": "Windows-10-Enterprise-multi-session-with-Office-365-ProPlus-1909"
								},
								{
									"label": "Windows 10 Enterprise multi-session, Version 1909",
									"value": "Windows-10-Enterprise-multi-session-1909"
								},
								{
									"label": "Windows 10 Enterprise, Version 1909",
									"value": "Windows-10-Enterprise-1909"
								},
								{
									"label": "Windows Server 2016 Datacenter",
									"value": "2016-Datacenter"
								}
							]
						},
						"visible": "[equals(steps('virtualMachineSettings').vmImageType, 'Gallery')]"
					},
					{
						"name": "rdshVMDiskTypeAll",
						"type": "Microsoft.Common.DropDown",
						"label": "Disk Type",
						"defaultValue": "Premium SSD",
						"toolTip": "These are the disk types available with the selected VM SKU.",
						"constraints": {
							"allowedValues": [
								{
									"label": "Premium SSD",
									"value": "Premium_LRS"
								},
								{
									"label": "Standard SSD",
									"value": "StandardSSD_LRS"
								},
								{
									"label": "Standard HDD",
									"value": "Standard_LRS"
								}
							]
						},
						"visible": "[contains(replace(steps('configureVirtualMachines').virtualMachineSize, 'Standard_', ''), 's')]"
					},
					{
						"name": "rdshVMDiskTypeStandard",
						"type": "Microsoft.Common.DropDown",
						"label": "Disk type",
						"defaultValue": "Standard SSD",
						"toolTip": "The disk types available with the selected VM SKU are 'Standard SSD' and Standard HDD'. If you would like to use premium storage, go back and change your VM SKU to one that contains an 's'.",
						"constraints": {
							"allowedValues": [
								{
									"label": "Standard SSD",
									"value": "StandardSSD_LRS"
								},
								{
									"label": "Standard HDD",
									"value": "Standard_LRS"
								}
							]
						},
						"visible": "[not(contains(replace(steps('configureVirtualMachines').virtualMachineSize, 'Standard_', ''), 's'))]"
					},
					{
						"name": "domainUser",
						"type": "Microsoft.Common.TextBox",
						"label": "AD domain join UPN",
						"toolTip": "UPN of an Active Directory user that has permissions and will be used to join the virtual machines to your domain. For example, vmjoiner@contoso.com. A local user account with this name will be created on each virtual machine. Do not enter a user who has MFA enabled. See https://aka.ms/vmUsernameReq for invalid usernames.",
						"visible": true,
						"constraints": {
							"required": true,
							"regex": "^[a-zA-Z0-9_.+-`~!#$%^(){}]+@([a-zA-Z0-9-]+(-[a-zA-Z0-9]+)*\\.)+[a-zA-Z]{2,}$",
							"validationMessage": "Please enter a valid UPN, like vmjoiner@contoso.com"
						}
					},
					{
						"name": "password",
						"type": "Microsoft.Compute.CredentialsCombo",
						"label": {
							"password": "Admin Password",
							"confirmPassword": "Confirm password"
						},
						"osPlatform": "Windows",
						"toolTip": {
							"password": "Password corresponding to the 'AD domain join UPN'. The local user account created on the virtual machines will also use this password. You can delete the user or reset the password after initial VM provisioning."
						},
						"constraints": {
							"required": true
						},
						"options": {
							"hideConfirmation": false
						},
						"visible": true
					},
					{
						"name": "specifyDetailedDomainConfiguration",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Specify domain or OU",
						"toolTip": "Select 'Yes' if you would like to join the virtual machines to a specific domain or organization unit (OU). Otherwise, by selecting 'False', the virtual machines will not be joined to an OU and the suffix of the 'AD domain join UPN' will be used as the domain name. For 'vmjoiner@contoso.com', the default domain name would be 'contoso.com'.",
						"visible": true,
						"defaultValue": "No",
						"constraints": {
							"allowedValues": [
								{
									"label": "No",
									"value": false
								},
								{
									"label": "Yes",
									"value": true
								}
							]
						}
					},
					{
						"name": "domainToJoin",
						"type": "Microsoft.Common.TextBox",
						"label": "Domain to join",
						"toolTip": "FQDN of the AD Domain to which session host VMs are going to be joined. For example, 'contoso.com' or 'site1.contoso.com'.",
						"defaultValue": "",
						"constraints": {
							"required": false,
							"regex": "^([a-zA-Z0-9-]+(-[a-zA-Z0-9]+)*\\.)+[a-zA-Z]{2,}$",
							"validationMessage": "Please enter a domain name with alphanumeric characters, separated by period, like 'contoso.com' or 'site1.contoso.com'"
						},
						"visible": "[steps('virtualMachineSettings').specifyDetailedDomainConfiguration]"
					},
					{
						"name": "ouPath",
						"type": "Microsoft.Common.TextBox",
						"label": "(Optional) OU path",
						"defaultValue": "",
						"constraints": {
							"required": false,
							"regex": "^(OU=[^,]+)(,OU=[^,]+)*(,DC=[^\\W-][a-zA-Z0-9-]*[^\\W-.]){2,}$",
							"validationMessage": "The OU path should contain 1 or more OU values specifying the organizaion unit and 2 or more DC values specifying the domain, in a comma separated format like 'OU=unit1,DC=contoso,DC=com'. Leading and trailing whitespace is not allowed."
						},
						"toolTip": "Enter the name of the organizational unit (OU) you would like the virtual machines to join. If you do not have a specific OU, leave this parameter empty. The OU should look like 'OU=unit1,DC=contoso,DC=com'",
						"visible": "[steps('virtualMachineSettings').specifyDetailedDomainConfiguration]"
					},
					{
						"name": "hostpoolVnet",
						"type": "Microsoft.Network.VirtualNetworkCombo",
						"label": {
							"virtualNetwork": "Virtual network",
							"subnets": "Subnets"
						},
						"toolTip": {
							"virtualNetwork": "Select the virtual network connected to the domain. If you do not, the virtual machines will be created but not joined to the domain and will not be able to receive connections.",
							"subnets": "Select the subnet with available addresses to host the virtual machines."
						},
						"defaultValue": {
							"name": "vnet-01",
							"addressPrefixSize": "/24"
						},
						"constraints": {
							"minAddressPrefixSize": "/30"
						},
						"options": {
							"hideExisting": false
						},
						"subnets": {
							"subnet1": {
								"label": "vmSubnet",
								"defaultValue": {
									"name": "vmSubnet",
									"addressPrefixSize": "/26"
								},
								"constraints": {
									"minAddressPrefixSize": "/30",
									"minAddressCount": "[max( mul(coalesce(steps('configureVirtualMachines').usageProfile.vmCountMultiplier, '0'),int(coalesce(steps('configureVirtualMachines').virtualMachineCount, '1'))), max(mul(basics('isPersonalDesktop').personalMultiplier, int(coalesce(steps('configureVirtualMachines').totalUsers,'1'))), mul( coalesce(steps('configureVirtualMachines').usageProfile.usageProfileMultiplier,'0'), div (sub (add( mul(int(take(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(skip(replace(replace(steps('configureVirtualMachines').virtualMachineSize, 'Standard_', ''), 'Basic_', ''), 1), '_', '  '), 'C', ''), 'V', ''), 'S', ''), 'D', ''), 'B', ''), 's', ' '), 'm', ' '), 'r', ' '), 'i', ' '), 'h', ' '), 'a', ' '), 'l', ' '), 't', ' '), 3)), coalesce(steps('configureVirtualMachines').usageProfile.value,'1') ), int(coalesce(steps('configureVirtualMachines').totalUsers,'1') )),1),   mul(int(take(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(skip(replace(replace(steps('configureVirtualMachines').virtualMachineSize, 'Standard_', ''), 'Basic_', ''), 1), '_', '  '), 'C', ''), 'V', ''), 'S', ''), 'D', ''), 'B', ''), 's', ' '), 'm', ' '), 'r', ' '), 'i', ' '), 'h', ' '), 'a', ' '), 'l', ' '), 't', ' '), 3)), coalesce(steps('configureVirtualMachines').usageProfile.value,'1') ))  )))]",
									"requireContiguousAddresses": false
								}
							}
						},
						"visible": true
					},
					{
						"name": "virtualNetworkError",
						"type": "Microsoft.Common.InfoBox",
						"visible": "[equals('new', steps('virtualMachineSettings').hostpoolVnet.newOrExisting)]",
						"options": {
							"icon": "Error",
							"text": "You must select an existing virtual network that has access to the Active Directory. If you do not see it listed, you must re-start the deployment with the correct Azure location selected."
						}
					}
				]
			},
            {
                "name": "lzSettings",
                "label": "Préfix de la compagnie à l'échelle de l'entreprise!",
                "subLabel": {
                    "preValidation": "Provide a company prefix for the management group structure that will be created.",
                    "postValidation": "Done"
                },
                "bladeTitle": "Company prefix",
                "elements": [
                    {
                        "name": "info",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "Enterprise-Scale ARM deployment requires access at the tenant root (/) scope. Visit this link to ensure you have the appropriate RBAC permission to complete the deployment",
                            "uri": "https://docs.microsoft.com/azure/role-based-access-control/elevate-access-global-admin"
                        }
                    },
                    {
                        "name": "mgmtGroup",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Enterprise-Scale will create the management group hierarchy under the Tenant Root Group with the prefix provided at this step.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-group-and-subscription-organization"
                            }
                        }
                    },
                    {
                        "name": "esMgmtGroup",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Management Group prefix",
                        "toolTip": "Provide a prefix (max 10 characters, unique at tenant-scope) for the Management Group hierarchy and other resources created as part of Enterprise-scale.",
                        "defaultValue": "",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{1,10}$",
                            "validationMessage": "The prefix must be 1-10 characters."
                        }
                    }
                ]
            },
            {
                "name": "esGoalState",
                "label": "Platform management, security, and governance",
                "subLabel": {
                    "preValidation": "",
                    "postValidation": ""
                },
                "bladeTitle": "lzGs",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "To enable platform management, security and governance, you must allocate a management Subscription. Please note, this Subscription will be moved to the platform Management Group, and ARM will deploy a Log Analytics workspace and requisite settings. We recommend using a new Subscription with no existing resources. Note that Azure Policy will be used to govern the configuration for the platform at scale.",
                            "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-and-monitoring"
                        }
                    },
                    {
                        "name": "esLogAnalytics",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Log Analytics workspace and enable monitoring for your platform and resources",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continious compliance.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esLogRetention",
                        "type": "Microsoft.Common.Slider",
                        "min": 30,
                        "max": 730,
                        "label": "Log Analytics Data Retention (days)",
                        "subLabel": "Days",
                        "defaultValue": 30,
                        "showStepMarkers": false,
                        "toolTip": "Select retention days for Azure logs. Default is 30 days.",
                        "constraints": {
                            "required": false
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "mgmtSubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "esMgmtSub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Management subscription",
                        "toolTip": "",
                        "multiselect": false,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]",
                        "constraints": {
                            "allowedValues": "[map(steps('esGoalState').mgmtSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": true
                        }
                    },
                    {
                        "name": "monitoring",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]",
                        "options": {
                            "text": "Select which Azure Monitor solutions you will enable for your Log Analytics workspace",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/azure-monitor/insights/solutions"
                            }
                        }
                    },
                    {
                        "name": "esAgentSolution",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Agent Health solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esChangeTracking",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Change Tracking solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esUpdateMgmt",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Update Management solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esActivityLog",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Activity Log solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esVmInsights",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy VM Insights solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esAntiMalware",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Antimalware solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esServiceMap",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Service Map solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esSqlAssessment",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy SQL Assessment solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "textBlock0",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]",
                        "options": {
                            "text": "Select which Azure Security solutions you will enable.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/security/fundamentals/overview"
                            }
                        }
                    },
                    {
                        "name": "esAsc",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Azure Security Center and enable security monitoring for your platform and resources",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esAscVms",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for servers",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for all servers.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAscApps",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for AppServices",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for AppServices.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAscStorage",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for Storage",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Storage.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAscSql",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for SQL",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for SQL.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAscKeyVault",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for Key Vault",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Key Vault.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAscArm",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for Azure Resource Manager",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Resource Manager.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAscDns",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for DNS",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for DNS.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAscKubernetes",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for Kubernetes",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Kubernetes.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAscRegistries",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Azure Defender for Container registries",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Container registries.",
                        "visible": "[equals(steps('esGoalState').esAsc, 'Yes')]",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Standard"
                                },
                                {
                                    "label": "No, Azure Defender Off",
                                    "value": "Free"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esSecuritySolution",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Azure Sentinel",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    }
                ]
            },
            {
                "name": "esConnectivityGoalState",
                "label": "Connectivity (Hub & Spoke)",
                "subLabel": {
                    "preValidation": "",
                    "postValidation": ""
                },
                "bladeTitle": "lzGs",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "To enable Hub & Spoke connectivity, you must allocate a connectivity Subscription. Please note, this Subscription will be moved to the connectivity Management Group, and ARM will deploy the first networking hub and requisite settings. We recommend using a new Subscription with no existing resources.",
                            "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/network-topology-and-connectivity#traditional-azure-networking-topology"
                        }
                    },
                    {
                        "name": "esHub",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy virtual hub network",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy virtual network for hub",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "nwSubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "esConnectivitySub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Connectivity subscription",
                        "toolTip": "",
                        "multiselect": false,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": "[equals(steps('esConnectivityGoalState').esHub, 'Yes')]",
                        "constraints": {
                            "allowedValues": "[map(steps('esConnectivityGoalState').nwSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": true
                        }
                    },
                    {
                        "name": "esAddressHub",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Address space (required for hub virtual hub)",
                        "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.0.0/16)",
                        "defaultValue": "10.100.0.0/16",
                        "visible": "[equals(steps('esConnectivityGoalState').esHub, 'Yes')]",
                        "constraints": {
                            "required": true,
                            "validationMessage": "The virtual hubs network's address space, specified as one address prefixes in CIDR notation (e.g. 192.168.1.0/24)"
                        }
                    },
                    {
                        "name": "esLocationsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "locations?api-version=2019-11-01"
                        }
                    },
                    {
                        "name": "esNwLocation",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Region for the first virtual network hub",
                        "filter": true,
                        "toolTip": "Select the target region for you connectivity deployment (requires you to provide a subscriptionId for connectivity)",
                        "constraints": {
                            "allowedValues": "[map(steps('esConnectivityGoalState').esLocationsApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.name, '\"}')))]",
                            "required": true
                        },
                        "visible": "[equals(steps('esConnectivityGoalState').esHub, 'Yes')]"
                    },
                    {
                        "name": "esVpnGw",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy VPN Gateway",
                        "defaultValue": "No",
                        "visible": "[equals(steps('esConnectivityGoalState').esHub, 'Yes')]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy VPN gateway",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esGwOrErAz",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Select Availability Zones for the Virtual Network Gateway/ExpressRoute Gateway",
                        "defaultValue": "None",
                        "multiselect": true,
                        "selectAll": true,
                        "filter": true,
                        "visible": "[and(or(equals(steps('esConnectivityGoalState').esVpnGw, 'Yes'), equals(steps('esConnectivityGoalState').esErGw, 'Yes')), or(or(or(or(or(or(or(or(equals(steps('esConnectivityGoalState').esNwLocation, 'canadacentral'), equals(steps('esConnectivityGoalState').esNwLocation, 'centralus')), equals(steps('esConnectivityGoalState').esNwLocation, 'eastus'), equals(steps('esConnectivityGoalState').esNwLocation, 'eastus2')), equals(steps('esConnectivityGoalState').esNwLocation, 'southcentralus'), equals(steps('esConnectivityGoalState').esNwLocation, 'westus2')), equals(steps('esConnectivityGoalState').esNwLocation, 'francecentral'), equals(steps('esConnectivityGoalState').esNwLocation, 'germanywestcentral')), equals(steps('esConnectivityGoalState').esNwLocation, 'northeurope'), equals(steps('esConnectivityGoalState').esNwLocation, 'westeurope')), equals(steps('esConnectivityGoalState').esNwLocation, 'uksouth'), equals(steps('esConnectivityGoalState').esNwLocation, 'southafricanorth')), equals(steps('esConnectivityGoalState').esNwLocation, 'japaneast'), equals(steps('esConnectivityGoalState').esNwLocation, 'southeastasia')), equals(steps('esConnectivityGoalState').esNwLocation, 'southeastasia'), equals(steps('esConnectivityGoalState').esNwLocation, 'australiaeast')))]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Virtual Gateway/Express Route Gateway to the selected region and availability zones.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Zone 1",
                                    "value": "1"
                                },
                                {
                                    "label": "Zone 2",
                                    "value": "2"
                                },
                                {
                                    "label": "Zone 3",
                                    "value": "3"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esVpnGwType",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Select VPN type",
                        "defaultValue": "Route Based",
                        "visible": "[equals(steps('esConnectivityGoalState').esVpnGw, 'Yes')]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy VPN gateway. Select whether it should be policy or route based.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Policy Based",
                                    "value": "PolicyBased"
                                },
                                {
                                    "label": "Route Based",
                                    "value": "RouteBased"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAddressVpnOrEr",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Subnet for VPN/ExpressRoute Gateways",
                        "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.1.0/24)",
                        "defaultValue": "10.100.1.0/24",
                        "visible": "[or(equals(steps('esConnectivityGoalState').esErGw, 'Yes'), equals(steps('esConnectivityGoalState').esVpnGw, 'Yes'))]",
                        "constraints": {
                            "required": true,
                            "validationMessage": "The subnet network's address space, specified as one address prefixes in CIDR notation (e.g. 192.168.1.0/24)"
                        }
                    },
                    {
                        "name": "esErGw",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy ExpressRoute Gateway",
                        "defaultValue": "No",
                        "visible": "[equals(steps('esConnectivityGoalState').esHub, 'Yes')]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Express Route gateway",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAzFw",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Azure Firewall",
                        "defaultValue": "Yes (recommended)",
                        "visible": "[equals(steps('esConnectivityGoalState').esHub, 'Yes')]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Azure Firewall",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esFwAz",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Select Availability Zones for the Azure Firewall",
                        "defaultValue": "None",
                        "multiselect": true,
                        "selectAll": true,
                        "filter": true,
                        "visible": "[and(equals(steps('esConnectivityGoalState').esAzFw, 'Yes'), or(or(or(or(or(or(or(or(equals(steps('esConnectivityGoalState').esNwLocation, 'canadacentral'), equals(steps('esConnectivityGoalState').esNwLocation, 'centralus')), equals(steps('esConnectivityGoalState').esNwLocation, 'eastus'), equals(steps('esConnectivityGoalState').esNwLocation, 'eastus2')), equals(steps('esConnectivityGoalState').esNwLocation, 'southcentralus'), equals(steps('esConnectivityGoalState').esNwLocation, 'westus2')), equals(steps('esConnectivityGoalState').esNwLocation, 'francecentral'), equals(steps('esConnectivityGoalState').esNwLocation, 'germanywestcentral')), equals(steps('esConnectivityGoalState').esNwLocation, 'northeurope'), equals(steps('esConnectivityGoalState').esNwLocation, 'westeurope')), equals(steps('esConnectivityGoalState').esNwLocation, 'uksouth'), equals(steps('esConnectivityGoalState').esNwLocation, 'southafricanorth')), equals(steps('esConnectivityGoalState').esNwLocation, 'japaneast'), equals(steps('esConnectivityGoalState').esNwLocation, 'southeastasia')), equals(steps('esConnectivityGoalState').esNwLocation, 'southeastasia'), equals(steps('esConnectivityGoalState').esNwLocation, 'australiaeast')))]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Azure Firewall to the selected region and availability zones.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Zone 1",
                                    "value": "1"
                                },
                                {
                                    "label": "Zone 2",
                                    "value": "2"
                                },
                                {
                                    "label": "Zone 3",
                                    "value": "3"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAddressFw",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Subnet for Azure Firewall",
                        "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.0.0/24)",
                        "defaultValue": "10.100.0.0/24",
                        "visible": "[equals(steps('esConnectivityGoalState').esAzFw, 'Yes')]",
                        "constraints": {
                            "required": true,
                            "validationMessage": "The subnet network's address space, specified as one address prefixes in CIDR notation (e.g. 192.168.1.0/24)"
                        }
                    }
                ]
            },
            {
                "name": "esIdentityGoalState",
                "label": "Identity",
                "subLabel": {
                    "preValidation": "",
                    "postValidation": ""
                },
                "bladeTitle": "lzGs",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "To enable identity (AuthN/AuthZ) for workloads in landing zones, you must allocate an identity Subscription that is dedicated to host your Active Directory domain controllers. Please note, this Subscription will be moved to the identity Management Group, and ARM will assign the selected policies. We recommend using a new Subscription with no existing resources.",
                            "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/identity-and-access-management"
                        }
                    },
                    {
                        "name": "esIdentity",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable identity subscription",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will move selected subscription into identity management group",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esIdentitySubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "esIdentitySub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Identity subscription",
                        "toolTip": "",
                        "multiselect": false,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": "[equals(steps('esIdentityGoalState').esIdentity, 'Yes')]",
                        "constraints": {
                            "allowedValues": "[map(steps('esIdentityGoalState').esIdentitySubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": true
                        }
                    },
                    {
                        "name": "identitypolicies",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": "[equals(steps('esIdentityGoalState').esIdentity, 'Yes')]",
                        "options": {
                            "text": "Select which of the the recommended policies you will assign to your identity management group.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#policy-driven-governance"
                            }
                        }
                    },
                    {
                        "name": "esIdDenyRdp",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent inbound RDP from internet",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and prevent inbound RDP from internet",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esIdentityGoalState').esIdentity, 'Yes')]"
                    },
                    {
                        "name": "esIdDenySubnetNsg",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure subnets are associated with NSG",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure NSGs must be associated with subnets being created",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esIdentityGoalState').esIdentity, 'Yes')]"
                    },
                    {
                        "name": "esIdDenyPublicIp",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent usage of public IP",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure public IP resources cannot be created",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esIdentityGoalState').esIdentity, 'Yes')]"
                    },
                    {
                        "name": "esIdAzBackup",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure VMs (Windows & Linux) are enabled for Azure Backup",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and enable Azure Backup on all VMs in the landing zones.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esIdentityGoalState').esIdentity, 'Yes')]"
                    }
                ]
            },
            {
                "name": "lzGoalState",
                "label": "Landing zone configuration",
                "subLabel": {
                    "preValidation": "",
                    "postValidation": ""
                },
                "bladeTitle": "lzGs",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "You can optionally provide subscriptions for your first landing zones for both 'online' and 'corp' and assign recommended policies that will ensure workloads will be secure, monitored, and protected according to best practices.",
                            "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#policy-driven-governance"
                        }
                    },
                    {
                        "name": "corpText",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Select the subscriptions you want to move to corp management group.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#subscription-democratization"
                            }
                        }
                    },
                    {
                        "name": "esLzConnectivity",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Connect corp landing zones to the connectivity hub (optional)?",
                        "defaultValue": "[if(equals(steps('esConnectivityGoalState').esHub, 'Yes'), 'Yes (recommended)', 'No')]",
                        "toolTip": "If 'Yes' is selected for corp landing zones, ARM will connect the subscriptions to the hub virtual network via VNet peering.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esConnectivityGoalState').esHub, 'Yes')]"
                    },
                    {
                        "name": "lzCorpSubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "esCorpLzSub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Corp landing zone subscriptions (optional)",
                        "toolTip": "",
                        "multiselect": true,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": "[or(equals(steps('esConnectivityGoalState').esHub, 'No'), equals(steps('lzGoalState').esLzConnectivity, 'No'))]",
                        "constraints": {
                            "allowedValues": "[map(steps('lzGoalState').lzCorpSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": false
                        }
                    },
                    {
                        "name": "lzConnectedSubs",
                        "type": "Microsoft.Common.EditableGrid",
                        "ariaLabel": "Add existing subscriptions into the management group landing zone and provide address space for virtual network peering",
                        "label": "Corp connected landing zone subscriptions (optional)",
                        "visible": "[equals(steps('lzGoalState').esLzConnectivity, 'Yes')]",
                        "constraints": {
                            "width": "Full",
                            "rows": {
                                "count": {
                                    "min": 1,
                                    "max": 10
                                }
                            },
                            "columns": [
                                {
                                    "id": "subs",
                                    "header": "Subscription",
                                    "width": "1fr",
                                    "element": {
                                        "name": "esLzConnectedSub",
                                        "type": "Microsoft.Common.DropDown",
                                        "label": "Landing zone subscription",
                                        "toolTip": "",
                                        "multiselect": false,
                                        "selectAll": false,
                                        "filter": true,
                                        "filterPlaceholder": "Filter items ...",
                                        "multiLine": false,
                                        "constraints": {
                                            "allowedValues": "[map(steps('lzGoalState').lzSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                                            "required": false
                                        }
                                    }
                                },
                                {
                                    "id": "addresses",
                                    "header": "Virtual Network Address space",
                                    "width": "1fr",
                                    "element": {
                                        "type": "Microsoft.Common.TextBox",
                                        "placeholder": "Ensure there are no overlapping IP addresses!",
                                        "constraints": {
                                            "required": true,
                                            "validations": [
                                                {
                                                    "message": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long."
                                                }
                                            ]
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "lzSubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "onlineText",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Select the subscriptions you want to move to online management group.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#subscription-democratization"
                            }
                        }
                    },
                    {
                        "name": "lzOnlineSubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "esOnlineLzSub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Online landing zone subscriptions (optional)",
                        "toolTip": "",
                        "multiselect": true,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": true,
                        "constraints": {
                            "allowedValues": "[map(steps('lzGoalState').lzOnlineSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": false
                        }
                    },
                    {
                        "name": "azMonText",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Select which of the the recommended policies you will assign to your landing zones.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#policy-driven-governance"
                            }
                        }
                    },
                    {
                        "name": "esVmMonitoring",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure VMs (Windows & Linux) are being monitored",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esVmssMonitoring",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure VMSS (Windows & Linux) are being monitored",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esArcVmMonitoring",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure Arc VMs (Windows & Linux) are being monitored",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esGoalState').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esAksPolicy",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Kubernetes (AKS) for Azure Policy",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esAksPriv",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent privileged containers in Kubernetes clusters",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, policy will be assigned to prevent privileged containers in AKS",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esAksNoPriv",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent privileged escalation in Kubernetes clusters",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, policy will be assigned to prevent privileged escalations in AKS",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esAksIngress",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure HTTPS ingress is enforced in Kubernetes clusters",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, HTTPS ingress will be required in AKS",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esAzBackup",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure VMs (Windows & Linux) are enabled for Azure Backup",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and enable Azure Backup on all VMs in the landing zones.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esDenyRdp",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent inbound RDP from internet",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and prevent inbound RDP from internet",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esNsg",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure subnets are associated with NSG",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure NSGs must be associated with subnets being created",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esIpForwarding",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent IP forwarding",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and prevent IP forwarding",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esSqlEncryption",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure SQL is enabled with transparent data encryption",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esSqlAudit",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure auditing is enabled on Azure SQL",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure auditing is enabled on Azure SQLs",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esHttpsStorage",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure secure connections (HTTPS) to storage accounts",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure storage can only be accessed using HTTPS",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    }
                ]
            },
            {
                "name": "locationsSettings",
                "label": "Régions permises",
                "subLabel": {
                    "preValidation": "Permet de sélectionner la liste des régions permises.",
                    "postValidation": "Fait"
                },
                "bladeTitle": "Régions permises",
                "elements": [
                    {
                        "name": "info",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "Les régions sélectionnées seront les seules régions permises pour les groupes de ressources et leurs ressources."
                        }
                    },
                    {
                        "name": "esLocationsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "locations?api-version=2019-11-01"
                        }
                    },
                    {
                        "name": "esLocations",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Liste des régions",
                        "multiselect": true,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filtrer les régions...",
                        "multiLine": true,
                        "toolTip": "Sélectioner les régions permises.",
                        "defaultValue": "",
                        "constraints": {
                            "allowedValues": "[map(steps('locationsSettings').esLocationsApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.name, '\"}')))]",
                            "required": true
                        }
                    }
			
			,
			
			{
						"name": "esvirtualMachineSize",
						"type": "Microsoft.Common.DropDown",
                        "multiselect": true,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filtrer les VM Size...",
                        "multiLine": true,                        
						"label": "Virtual machine size",
						"toolTip": "Size of the virtual machines to deploy. Not all VM sizes are supported by this Azure Marketplace offer however all VM sizes are supported when using other deployment options, see <a target='_blank' href='https://aka.ms/wvdmpsupportedsku'>https://aka.ms/wvdmpsupportedsku</a> for more information.",
						"defaultValue": "",
						"constraints": {
							"allowedValues": [
								"Standard_A1_v2",
								"Standard_A2_v2",
								"Standard_A2m_v2",
								"Standard_A4_v2",
								"Standard_A4m_v2",
								"Standard_A8_v2",
								"Standard_A8m_v2",
								"Standard_B1ms",
								"Standard_B1s",
								"Standard_B2ms",
								"Standard_B2s",
								"Standard_B4ms",
								"Standard_B8ms",
								"Standard_D2_v3",
								"Standard_D2s_v3",
								"Standard_D4_v3",
								"Standard_D4s_v3",
								"Standard_D8_v3",
								"Standard_D8s_v3",
								"Standard_D16_v3",
								"Standard_D16s_v3",
								"Standard_D32_v3",
								"Standard_D32s_v3",
								"Standard_D64_v3",
								"Standard_D64s_v3",
								"Standard_E2_v3",
								"Standard_E2s_v3",
								"Standard_E4_v3",
								"Standard_E4s_v3",
								"Standard_E8_v3",
								"Standard_E8s_v3",
								"Standard_E16_v3",
								"Standard_E16s_v3",
								"Standard_E20_v3",
								"Standard_E20s_v3",
								"Standard_E32_v3",
								"Standard_E32s_v3",
								"Standard_E64_v3",
								"Standard_E64s_v3",
								"Standard_F1",
								"Standard_F1s",
								"Standard_F2",
								"Standard_F2s",
								"Standard_F2s_v2",
								"Standard_F4",
								"Standard_F4s",
								"Standard_F4s_v2",
								"Standard_F8",
								"Standard_F8s",
								"Standard_F8s_v2",
								"Standard_F16",
								"Standard_F16s",
								"Standard_F16s_v2",
								"Standard_F32s_v2",
								"Standard_F64s_v2",
								"Standard_F72s_v2",
								"Standard_H8",
								"Standard_H8m",
								"Standard_H16",
								"Standard_H16m",
								"Standard_H16r",
								"Standard_H16mr",
								"Standard_L4s",
								"Standard_L8s",
								"Standard_L8s_v2",
								"Standard_L16s",
								"Standard_L16s_v2",
								"Standard_L32s",
								"Standard_L32s_v2",
								"Standard_L64s_v2",
								"Standard_L80s_v2",
								"Standard_M8ms",
								"Standard_M16ms",
								"Standard_M32ms",
								"Standard_M64",
								"Standard_M64m",
								"Standard_M64ms",
								"Standard_M64s",
								"Standard_NC6",
								"Standard_NC6s_v2",
								"Standard_NC6s_v3",
								"Standard_NC12",
								"Standard_NC12s_v2",
								"Standard_NC12s_v3",
								"Standard_NC24",
								"Standard_NC24r",
								"Standard_NC24rs_v2",
								"Standard_NC24rs_v3",
								"Standard_NC24s_v2",
								"Standard_NC24s_v3",
								"Standard_ND6s",
								"Standard_ND12s",
								"Standard_ND24rs",
								"Standard_ND24s",
								"Standard_NV6",
								"Standard_NV6s_v2",
								"Standard_NV12",
								"Standard_NV12s_v2",
								"Standard_NV24",
								"Standard_NV24s_v2",
								"Standard_D2hs_v3",
								"Standard_D4hs_v3",
								"Standard_D8hs_v3",
								"Standard_B2hms",
								"Standard_B4hms",
								"Standard_NV4ahs_v4",
								"Standard_NV8ahs_v4",
								"Standard_NV16ahs_v4",
								"Standard_NV32ah7s_v4",
								"Standard_NV12hs_v3",
								"Standard_NV6h",
								"Standard_NV12s_v3",
								"Standard_NV24s_v3",
								"Standard_NV48s_v3",
								"Standard_NV4as_v4",
								"Standard_NV8as_v4",
								"Standard_NV16as_v4",
								"Standard_NV32as_v4"
							],
                            "required": true
						}						
					}
                ]
            }
        ],
        "outputs": {
            "vpnGwType": "[steps('esConnectivityGoalState').esVpnGwType]",
            "subnetMaskForGw": "[steps('esConnectivityGoalState').esAddressVpnOrEr]",
            "subnetMaskForAzFw": "[steps('esConnectivityGoalState').esAddressFw]",
            "enableErGw": "[steps('esConnectivityGoalState').esErGw]",
            "enableVpnGw": "[steps('esConnectivityGoalState').esVpnGw]",
            "enableHub": "[steps('esConnectivityGoalState').esHub]",
            "connectivitySubscriptionId": "[if(not(equals(steps('esConnectivityGoalState').esConnectivitySub, steps('esGoalState').esMgmtSub)), steps('esConnectivityGoalState').esConnectivitySub, '')]",
            "enableAzFw": "[steps('esConnectivityGoalState').esAzFw]",
            "addressPrefix": "[steps('esConnectivityGoalState').esAddressHub]",
            "location": "[steps('esConnectivityGoalState').esNwLocation]",
            "managementSubscriptionId": "[steps('esGoalState').esMgmtSub]",
            "identitySubscriptionId": "[if(or(not(equals(steps('esIdentityGoalState').esIdentitySub, steps('esGoalState').esMgmtSub)), not(equals(steps('esIdentityGoalState').esIdentitySub, steps('esConnectivityGoalState').esConnectivitySub))), steps('esIdentityGoalState').esIdentitySub, '')]",
            "onlineLzSubscriptionId": "[if(or(not(contains(steps('lzGoalState').esOnlineLzSub, steps('esGoalState').esMgmtSub)), not(contains(steps('lzGoalState').esOnlineLzSub, steps('esConnectivityGoalState').esConnectivitySub))), steps('lzGoalState').esOnlineLzSub, '')]",
            "corpLzSubscriptionId": "[if(or(not(contains(steps('lzGoalState').esCorpLzSub, steps('esGoalState').esMgmtSub)), not(contains(steps('lzGoalState').esCorpLzSub, steps('esConnectivityGoalState').esConnectivitySub))), steps('lzGoalState').esCorpLzSub, '')]",
            "enableLogAnalytics": "[steps('esGoalState').esLogAnalytics]",
            "denyRdpForIdentity": "[steps('esIdentityGoalState').esIdDenyRdp]",
            "denySubnetWithoutNsgForIdentity": "[steps('esIdentityGoalState').esIdDenySubnetNsg]",
            "denyPipForIdentity": "[steps('esIdentityGoalState').esIdDenyPublicIp]",
            "enableVmBackupForIdentity": "[steps('esIdentityGoalState').esIdAzBackup]",
            "enableAsc": "[steps('esGoalState').esAsc]",
            "enableAscForServers": "[steps('esGoalState').esAscVms]",
            "enableAscForAppServices": "[steps('esGoalState').esAscApps]",
            "enableAscForStorage": "[steps('esGoalState').esAscStorage]",
            "enableAscForSql": "[steps('esGoalState').esAscSql]",
            "enableAscForKeyVault": "[steps('esGoalState').esAscKeyVault]",
            "enableAscForArm": "[steps('esGoalState').esAscArm]",
            "enableAscForDns": "[steps('esGoalState').esAscDns]",
            "enableAscForKubernetes": "[steps('esGoalState').esAscKubernetes]",
            "enableAscForRegistries": "[steps('esGoalState').esAscRegistries]",
            "enableSecuritySolution": "[steps('esGoalState').esSecuritySolution]",
            "enableAgentHealth": "[steps('esGoalState').esAgentSolution]",
            "enableChangeTracking": "[steps('esGoalState').esChangeTracking]",
            "enableUpdateMgmt": "[steps('esGoalState').esUpdateMgmt]",
            "enableActivityLog": "[steps('esGoalState').esActivityLog]",
            "enableVmInsights": "[steps('esGoalState').esVmInsights]",
            "enableAntiMalware": "[steps('esGoalState').esAntiMalware]",
            "enableServiceMap": "[steps('esGoalState').esServiceMap]",
            "enableSqlAssessment": "[steps('esGoalState').esSqlAssessment]",
            "enterpriseScaleCompanyPrefix": "[steps('lzSettings').esMgmtGroup]",
            "enableSqlAudit": "[steps('lzGoalState').esSqlAudit]",
            "enableSqlEncryption": "[steps('lzGoalState').esSqlEncryption]",
            "enableVmBackup": "[steps('lzGoalState').esAzBackup]",
            "enableAksPolicy": "[steps('lzGoalState').esAksPolicy]",
            "denyAksPrivileged": "[steps('lzGoalState').esAksPriv]",
            "denyAksPrivilegedEscalation": "[steps('lzGoalState').esAksNoPriv]",
            "denyHttpIngressForAks": "[steps('lzGoalState').esAksIngress]",
            "denyRdp": "[steps('lzGoalState').esDenyRdp]",
            "enableStorageHttps": "[steps('lzGoalState').esHttpsStorage]",
            "denyIpForwarding": "[steps('lzGoalState').esIpForwarding]",
            "denySubnetWithoutNsg": "[steps('lzGoalState').esNsg]",
            "retentionInDays": "[string(steps('esGoalState').esLogRetention)]",
            "enableVmMonitoring": "[steps('lzGoalState').esVmMonitoring]",
            "enableVmssMonitoring": "[steps('lzGoalState').esVmssMonitoring]",
            "enableArcMonitoring": "[steps('lzGoalState').esArcVmMonitoring]",
            "vpnOrErZones": "[steps('esConnectivityGoalState').esGwOrErAz]",
            "firewallZones": "[steps('esConnectivityGoalState').esGwOrErAz]",
            "corpConnectedLzSubscriptionId": "[if(or(not(contains(steps('lzGoalState').esCorpLzSub, steps('esGoalState').esMgmtSub)), not(contains(steps('lzGoalState').esCorpLzSub, steps('esConnectivityGoalState').esConnectivitySub))), steps('lzGoalState').lzConnectedSubs, '')]",
            "Policy_Allowed-Locations": "[steps('locationsSettings').esLocations]"
        }
    }
}
